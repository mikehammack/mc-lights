<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Status Lights</title>
  <style>
    body { margin:0; background:#111; color:#fff; font-family:sans-serif; }
    .panel { display:flex; gap:16px; padding:8px; justify-content:center; }
    .light { background:#1a1a1a; border-radius:8px; box-shadow: inset 0 0 6px #000; width:110px; padding:8px; text-align:center; }
    .name { font-size:12px; color:#bbb; margin-top:6px; }
    .dot { width:12px; height:12px; border-radius:50%; margin:0 auto; box-shadow: 0 0 6px #000; }
    .ok { background:#00c853; box-shadow: 0 0 10px #00c853; }
    .bad { background:#d50000; box-shadow: 0 0 10px #d50000; }
    .unk { background:#757575; }
    .val { font-size:12px; color:#FFD600; margin-top:4px; }
    .hint { text-align:center; font-size:12px; color:#888; padding-bottom:8px; }
  </style>
</head>
<body>
  <div class="hint">HTTPS-only demo. LAN services over http will show as Unknown due to browser blocking mixed content.</div>
  <div class="panel" id="panel">
    <!-- Lights render here -->
  </div>

  <script>
    const lights = [
      { key: 'mc', name: 'Minecraft', type: 'minecraft', server: '172.125.126.129:25565' },
      // Add any HTTPS endpoints here as simple HTTP checks:
      // { key: 'httpsExample', name: 'My HTTPS Service', type: 'http', url: 'https://example.com/health' },
      // LAN http services will be marked Unknown until Phase 2:
      { key: 'octo', name: 'OctoPrint', type: 'http', url: 'http://192.168.1.232:5000' },
      { key: 'emby', name: 'Emby', type: 'http', url: 'http://192.168.1.220:8096' },
      { key: 'mcs', name: 'MCSManager', type: 'http', url: 'http://192.168.1.220:23333' },
    ];

    function lightEl(name, status, extra) {
      const cls = status === 'ok' ? 'ok' : status === 'bad' ? 'bad' : 'unk';
      return `
        <div class="light">
          <div class="dot ${cls}"></div>
          <div class="name">${name}</div>
          ${extra ? `<div class="val">${extra}</div>` : ''}
        </div>
      `;
    }

    async function checkMinecraft(server) {
      try {
        const res = await fetch(`https://api.mcsrvstat.us/2/${server}`);
        const data = await res.json();
        const online = data?.online === true;
        const players = data?.players?.online ?? 0;
        const max = data?.players?.max ?? 0;
        return { status: online ? 'ok' : 'bad', extra: `${players}/${max}` };
      } catch {
        return { status: 'unk', extra: '' };
      }
    }

    async function checkHttp(url) {
      // From an HTTPS page (GitHub Pages), browser blocks http:// requests.
      // We mark as Unknown until Phase 2 adds an HTTPS proxy.
      if (url.startsWith('http://')) {
        return { status: 'unk', extra: '' };
      }
      try {
        const res = await fetch(url, { method: 'GET', mode: 'cors' });
        return { status: res.ok ? 'ok' : 'bad', extra: '' };
      } catch {
        return { status: 'bad', extra: '' };
      }
    }

    async function render() {
      const panel = document.getElementById('panel');
      const results = await Promise.all(lights.map(async l => {
        if (l.type === 'minecraft') return { name: l.name, ...(await checkMinecraft(l.server)) };
        if (l.type === 'http') return { name: l.name, ...(await checkHttp(l.url)) };
        return { name: l.name, status: 'unk', extra: '' };
      }));
      panel.innerHTML = results.map(r => lightEl(r.name, r.status, r.extra)).join('');
    }

    render();
    setInterval(render, 30000);
  </script>
</body>
</html>
